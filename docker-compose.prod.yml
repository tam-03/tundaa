version: '3'
x-aws-vpc: "vpc-049300cf423e2a4bc"
services:
  web:
    build: .
    image: 677642048886.dkr.ecr.ap-northeast-1.amazonaws.com/tundaa:latest
    command: /bin/sh -c "bundle exec rails db:migrate RAILS_ENV=production &&
             bundle exec rails s -p 80 -b '0.0.0.0'"
    ports:
      - '80:80'
    environment:
      - 'RAILS_ENV=production'
      - 'RAILS_SERVE_STATIC_FILES=true'
      - 'RAILS_LOG_TO_STDOUT=true'
      - 'RACK_ENV=production'
      - RAILS_MASTER_KEY=$RAILS_MASTER_KEY
    depends_on:
      - db
  db:
    image: postgres
    environment:
      - 'POSTGRES_USER=tundaa'

